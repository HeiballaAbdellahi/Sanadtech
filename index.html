<!DOCTYPE html>
<html>
<head>
    <style>
        body {margin:0;}

.navbar {
  overflow: hidden;
  background-color: #333;
  position: fixed;
  top: 0;
  width: 100%;
}

.navbar a {
  float: left;
  display: block;
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 17px;
}

.navbar a:hover {
  background: #ddd;
  color: black;
}

.main {
  padding: 16px;
  margin-top: 30px;
  height: 1500px; /* Used in this example to enable scrolling */
}
    </style>
</head>
<body>
    <div class="navbar">
        <a onclick="putSquare()">Placer Le carré</a>
        <a onclick="toLink()">Lier Les Carrés</a>
        <a href="javascript:window.location.reload(true)">Réinitialiser</a>
      </div>

<br>
<br>
<br>

    <canvas id="myCanvas" width="1000" height="1000"></canvas>
      

   
<script>
    let linked =false;
    let placed =true;
    function toLink(){
        linked=true;
        placed=false;
    }
    function putSquare(){
        linked=false;
        placed=true;
    }
function getSquare(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
        x: 1 + (evt.clientX - rect.left) - (evt.clientX - rect.left)%10,
        y: 1 + (evt.clientY - rect.top) - (evt.clientY - rect.top)%10
    };
}

function linkSquare(context, x, y){
    context.lineWidth = 4;
   context.strokeStyle = "#E50404"
   context.beginPath();
        context.moveTo(x, y);
        context.lineTo(300, 150);
        context.stroke();
   
}


function drawGrid(context) {
    context.save()
    for (var x = 0.5; x < 1000; x += 100) {
      context.moveTo(x, 0);
      context.lineTo(x, 1000);
    }
    
    for (var y = 0.5; y < 1000; y += 100) {
      context.moveTo(0, y);
      context.lineTo(1000, y);
    }
    
    context.strokeStyle = "#ddd";
    context.stroke();

    context.setLineDash( [ 1, 4 ] )
    for (var x = 0.5; x < 1000; x += 10) {
      context.moveTo(x, 0);
      context.lineTo(x, 1000);
    }
    
    for (var y = 0.5; y < 1000; y += 10) {
      context.moveTo(0, y);
      context.lineTo(1000, y);
    }
    
    context.strokeStyle = "#ddd";
    context.stroke();
    context.restore();
}



function fillSquare(context, x, y){
    context.fillStyle = "#FFF2D6"
    context.fillRect(x-34,y-29,72-4,63-4);
}
function strokeSquare(context, x, y){
    context.fillStyle = "#777777"
    context.fillRect(x-36,y-31,72,63);
}

var canvas = document.getElementById('myCanvas');
var context = canvas.getContext('2d');

drawGrid(context);



const draw=(start,end)=>{
	var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");
    ctx.lineWidth = 4;
    ctx.strokeStyle = "#E50404";
    ctx.beginPath();
    ctx.moveTo(start.x, start.y);
    ctx.lineTo(end.x, end.y);
    ctx.stroke();
}

let points=[

]



let squares=[

]
const findSquare=(square)=>{
    let exists=false;
    for(let i in squares){
        if(squares[i].x==square.x && squares[i].y==square.y){
            exists=true;
        }
    }
    return exists;
}
canvas.addEventListener('click', function(evt) {
    if(placed){
var mousePos = getSquare(canvas, evt);
 
    
        const x=(Math.round(mousePos.x/100)*100);
        const y=(Math.round(mousePos.y/100)*100);

    if(!findSquare({x:x,y:y})){
        squares.push({x:x,y:y});
        strokeSquare(context, x, y)
        fillSquare(context, x, y)
        console.log(squares)
    }
    
    

    };
    if(linked){
        var mousePos = getSquare(canvas, evt);
        if(points.length==0){
        if(findSquare({x:(Math.round(mousePos.x/100)*100),y:(Math.round(mousePos.y/100)*100)})){
        points.push({x:(Math.round(mousePos.x/100)*100),y:(Math.round(mousePos.y/100)*100)})
        context.fillStyle = "#F0D1BA"
        context.fillRect((Math.round(mousePos.x/100)*100)-34,(Math.round(mousePos.y/100)*100)-29,72-4,63-4);   
        }
    	}
    else if(points.length==1){
        if(findSquare({x:(Math.round(mousePos.x/100)*100),y:(Math.round(mousePos.y/100)*100)})){
        points.push({x:(Math.round(mousePos.x/100)*100),y:(Math.round(mousePos.y/100)*100)})
        context.fillStyle = "#F0D1BA"
        context.fillRect((Math.round(mousePos.x/100)*100)-34,(Math.round(mousePos.y/100)*100)-29,72-4,63-4);  
        }
    	
    }
    draw(points[0],points[1])
    points=[]

       
    }

    
    
}, false);


</script>

</body>
</html> 